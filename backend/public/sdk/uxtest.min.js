/* UXTest SDK v1.0.0 | Privacy-first UX testing */
(()=>{(function(E){"use strict";var C="1.0.0",m="uxtest_offline_queue",U="http://localhost:3001",l=null,a=null,b=null,g=null,s=[],h=null,x=!1,n=null,r=0,p=null;function _(){return typeof crypto!="undefined"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}function i(){return Date.now()}function T(e,t,o){return new Promise(function(c,S){var u=new XMLHttpRequest;u.open(t,e,!0),u.setRequestHeader("Content-Type","application/json"),u.onload=function(){u.status>=200&&u.status<300?c(JSON.parse(u.responseText)):S(new Error("HTTP "+u.status))},u.onerror=function(){S(new Error("Network error"))},u.send(o?JSON.stringify(o):null)})}function w(){try{localStorage.setItem(m,JSON.stringify(s))}catch(e){}}function z(){try{var e=localStorage.getItem(m);e&&(s=JSON.parse(e).concat(s))}catch(t){}}function q(){try{localStorage.removeItem(m)}catch(e){}}function f(){if(s.length===0)return Promise.resolve();var e=s.slice();return s=[],T(l.endpoint+"/events","POST",{events:e}).then(function(){q(),console.log("[UXTest] Events sent successfully:",e.length)}).catch(function(t){s=e.concat(s),w(),console.warn("[UXTest] Failed to send events:",t.message),console.warn("[UXTest] Events queued for retry. If testing on HTTPS site, you need HTTPS backend or use ngrok.")})}function d(e,t,o){s.push({sessionId:b,projectId:l.projectId,testId:l.testId,variant:l.variant,type:e,payload:t||null,timestamp:i(),duration:o}),w(),s.length>=5&&f()}function N(){if(!n){var e=document.createElement("div");e.id="uxtest-widget";var t=document.createElement("style");t.textContent=j(),document.head.appendChild(t),document.body.appendChild(e),n=e,k()}}function k(){if(!(!n||!a)){var e=a.tasks||[],t=e[r],o=e.length>0?r/e.length*100:0;n.innerHTML='<div class="ux-header"><span class="ux-logo">\u25C8 UXTest</span><span class="ux-progress">'+(r+1)+"/"+e.length+'</span></div><div class="ux-progress-bar"><div class="ux-progress-fill" style="width:'+o+'%"></div></div><div class="ux-content"><div class="ux-task-num">Task '+(r+1)+'</div><h3 class="ux-task-title">'+y(t?t.title:"Complete the test")+'</h3><p class="ux-task-desc">'+y(t&&t.description||"")+'</p><div class="ux-timer" id="ux-timer">00:00</div><div class="ux-buttons"><button id="ux-done" class="ux-btn ux-btn-done">\u2713 '+(r<e.length-1?"Next Task":"Finish")+`</button><button id="ux-skip" class="ux-btn ux-btn-skip">Skip</button></div><button id="ux-abandon" class="ux-btn-abandon">Can't complete test</button></div>`,n.querySelector("#ux-done").onclick=H,n.querySelector("#ux-skip").onclick=M,n.querySelector("#ux-abandon").onclick=function(){v.abandon("user_abandoned")}}}function H(){var o;var e=a.tasks||[],t=i()-p;d("task_step_completed",{taskIndex:r,taskTitle:(o=e[r])==null?void 0:o.title},t),r<e.length-1?(r++,p=i(),k()):v.success()}function M(){var t;var e=a.tasks||[];d("task_step_skipped",{taskIndex:r,taskTitle:(t=e[r])==null?void 0:t.title}),r<e.length-1?(r++,p=i(),k()):v.abandon("all_tasks_skipped")}function I(e){if(n){var t=Math.floor((i()-g)/1e3),o=Math.floor(t/60),c=t%60;n.innerHTML='<div class="ux-complete"><div class="ux-complete-icon">'+(e?"\u{1F6AB}":"\u2705")+"</div><h3>"+(e?"Test Ended":"All Tasks Complete!")+"</h3><p>"+(e?"Thanks for participating":"Completed in "+o+"m "+c+"s")+"</p></div>",setTimeout(function(){n&&n.parentNode&&(n.parentNode.removeChild(n),n=null)},3e3)}}function X(){if(n){var e=n.querySelector("#ux-timer");if(e){var t=Math.floor((i()-p)/1e3),o=Math.floor(t/60),c=t%60;e.textContent=(o<10?"0":"")+o+":"+(c<10?"0":"")+c}}}function y(e){var t=document.createElement("div");return t.textContent=e||"",t.innerHTML}function j(){return"#uxtest-widget{position:fixed;bottom:20px;right:20px;width:300px;background:linear-gradient(145deg,#1a1a2e,#16213e);border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,0.4);font-family:-apple-system,sans-serif;color:#fff;z-index:2147483647;overflow:hidden}.ux-header{display:flex;justify-content:space-between;padding:10px 14px;background:rgba(255,255,255,0.05);border-bottom:1px solid rgba(255,255,255,0.1)}.ux-logo{font-weight:600;font-size:13px;color:#60a5fa}.ux-progress{font-size:12px;color:#94a3b8}.ux-progress-bar{height:3px;background:rgba(255,255,255,0.1)}.ux-progress-fill{height:100%;background:linear-gradient(90deg,#10b981,#60a5fa);transition:width 0.3s}.ux-content{padding:16px}.ux-task-num{font-size:10px;font-weight:600;letter-spacing:0.1em;color:#f59e0b;margin-bottom:4px}.ux-task-title{font-size:16px;font-weight:600;margin:0 0 6px;color:#f1f5f9}.ux-task-desc{font-size:13px;color:#94a3b8;margin:0 0 12px;line-height:1.4}.ux-timer{text-align:center;font-size:24px;font-weight:700;font-family:monospace;color:#60a5fa;margin-bottom:14px;padding:10px;background:rgba(96,165,250,0.1);border-radius:6px}.ux-buttons{display:flex;gap:8px;margin-bottom:10px}.ux-btn{flex:1;padding:10px;border:none;border-radius:6px;font-size:13px;font-weight:600;cursor:pointer}.ux-btn-done{background:linear-gradient(135deg,#10b981,#059669);color:#fff}.ux-btn-done:hover{transform:translateY(-1px)}.ux-btn-skip{background:rgba(255,255,255,0.1);color:#94a3b8}.ux-btn-skip:hover{background:rgba(255,255,255,0.15)}.ux-btn-abandon{width:100%;padding:8px;background:none;border:1px solid rgba(239,68,68,0.3);border-radius:6px;color:#f87171;font-size:12px;cursor:pointer}.ux-btn-abandon:hover{background:rgba(239,68,68,0.1)}.ux-complete{text-align:center;padding:30px 20px}.ux-complete-icon{font-size:40px;margin-bottom:10px}.ux-complete h3{margin:0 0 6px;color:#10b981}.ux-complete p{margin:0;color:#94a3b8;font-size:13px}"}function O(){return T(l.endpoint+"/tests/"+l.testId,"GET",null).then(function(e){return a=e,(!a.tasks||a.tasks.length===0)&&(a.tasks=[{title:a.name,description:a.instructions||a.description}]),e}).catch(function(e){console.warn("[UXTest] Could not fetch test:",e),a={tasks:[{title:"Complete the task",description:""}]}})}var v={init:function(e){if(x)return Promise.resolve();if(!e||!e.projectId||!e.testId)throw new Error("projectId and testId required");return l={projectId:e.projectId,testId:e.testId,variant:e.variant||"A",endpoint:(e.endpoint||U).replace(/\/$/,"")},b=_(),g=i(),p=i(),r=0,x=!0,z(),d("test_started",{url:location.href,userAgent:navigator.userAgent}),h=setInterval(f,1e4),window.addEventListener("beforeunload",function(){f()}),O().then(function(){N(),setInterval(X,1e3),console.log("[UXTest] Ready -",a.tasks.length,"tasks")})},logEvent:function(e,t){x&&d(e,t)},success:function(e){if(x){var t=i()-g;d("test_completed",e,t),f(),clearInterval(h),I(!1)}},abandon:function(e){if(x){var t=i()-g;d("test_abandoned",{reason:e,lastTaskIndex:r},t),f(),clearInterval(h),I(!0)}},version:C,getSessionId:function(){return b}};E.UXTest=v})(typeof window!="undefined"?window:void 0);})();
//# sourceMappingURL=uxtest.min.js.map
