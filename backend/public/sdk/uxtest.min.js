/* UXTest SDK v1.0.0 | Privacy-first UX testing */
(()=>{var A=Object.defineProperty;var j=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var O=(c,i,o)=>i in c?A(c,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):c[i]=o,D=(c,i)=>{for(var o in i||(i={}))H.call(i,o)&&O(c,o,i[o]);if(j)for(var o of j(i))F.call(i,o)&&O(c,o,i[o]);return c};(function(c){"use strict";var i="1.1.0",o="uxtest_queue",T="uxtest_session",q="http://localhost:3001",s=null,r=null,h=null,b=null,u=[],k=null,x=!1,v=null,n=0,m=null;function L(){return typeof crypto!="undefined"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function d(){return Date.now()}function I(){try{localStorage.setItem(T,JSON.stringify({sessionId:h,testId:s.testId,projectId:s.projectId,variant:s.variant,endpoint:s.endpoint,startTime:b,currentTaskIndex:n,taskStartTime:m,timestamp:d()}))}catch(t){}}function M(t){try{var e=localStorage.getItem(T);if(!e)return null;var a=JSON.parse(e);return a.testId===t&&d()-a.timestamp<36e5?a:null}catch(g){return null}}function U(){try{localStorage.removeItem(T)}catch(t){}}function X(t,e,a){return new Promise(function(g,E){var l=new XMLHttpRequest;l.open(e,t,!0),l.setRequestHeader("Content-Type","application/json"),l.timeout=15e3,l.onload=function(){if(l.status>=200&&l.status<300)try{g(JSON.parse(l.responseText))}catch(R){g({})}else E(new Error("HTTP "+l.status))},l.onerror=function(){E(new Error("Network error"))},l.ontimeout=function(){E(new Error("Timeout"))},l.send(a?JSON.stringify(a):null)})}function C(){try{localStorage.setItem(o,JSON.stringify(u))}catch(t){}}function _(){try{var t=localStorage.getItem(o);t&&(u=JSON.parse(t).concat(u))}catch(e){}}function J(){try{localStorage.removeItem(o)}catch(t){}}function p(){if(u.length===0||!s)return Promise.resolve();var t=u.slice();return u=[],console.log("[UXTest] Sending",t.length,"events to",s.endpoint),X(s.endpoint+"/events","POST",{events:t}).then(function(e){J(),console.log("[UXTest] \u2713 Events sent successfully")}).catch(function(e){u=t.concat(u),C(),console.error("[UXTest] \u2717 Failed to send events:",e.message)})}function f(t,e,a){var g={sessionId:h,projectId:s.projectId,testId:s.testId,variant:s.variant,type:t,payload:e||null,timestamp:d(),duration:a};u.push(g),C(),console.log("[UXTest] Event:",t),u.length>=5&&p()}function y(){v&&document.body.removeChild(v);var t=document.createElement("div");t.id="uxtest-widget";var e=document.createElement("style");e.textContent=P(),document.head.appendChild(e),document.body.appendChild(t),v=t,w()}function w(){if(!(!v||!r)){var t=r.tasks||[],e=t[n],a=t.length>0?n/t.length*100:0;v.innerHTML='<div class="ux-header"><div class="ux-title">\u{1F4CB} UX Test</div><div class="ux-progress-bar"><div class="ux-progress-fill" style="width:'+a+'%"></div></div><div class="ux-progress-text">Task '+(n+1)+" of "+t.length+'</div></div><div class="ux-body"><div class="ux-task-title">'+(e?e.title:"Complete the task")+'</div><div class="ux-task-desc">'+(e&&e.description||"")+`</div><div class="ux-timer" id="ux-timer">0:00</div><div class="ux-nav-hint">\u{1F4A1} Widget stays active when you navigate!</div></div><div class="ux-footer"><button class="ux-btn ux-btn-done" onclick="UXTest.success()">\u2713 Done</button><button class="ux-btn ux-btn-skip" onclick="UXTest.nextTask()">Skip \u2192</button><button class="ux-btn ux-btn-abandon" onclick="UXTest.abandon('user_quit')">\u2717 Quit</button></div>`}}function S(t){v&&(U(),v.innerHTML='<div class="ux-complete"><div class="ux-complete-icon">'+(t?"\u{1F44B}":"\u{1F389}")+"</div><h3>"+(t?"Test Ended":"All Done!")+"</h3><p>"+(t?"Thanks for participating":"Thank you for testing!")+`</p><button class="ux-btn ux-btn-done" onclick="document.getElementById('uxtest-widget').remove()" style="margin-top:15px">Close</button></div>`)}function N(){var t=document.getElementById("ux-timer");if(!(!t||!m)){var e=Math.floor((d()-m)/1e3),a=Math.floor(e/60),g=e%60;t.textContent=a+":"+(g<10?"0":"")+g}}function P(){return"#uxtest-widget{position:fixed;bottom:20px;right:20px;width:320px;background:linear-gradient(145deg,#1a1a2e,#16213e);border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,0.4);font-family:-apple-system,BlinkMacSystemFont,sans-serif;color:#fff;z-index:2147483647;border:1px solid rgba(255,255,255,0.1);overflow:hidden}.ux-header{padding:16px;border-bottom:1px solid rgba(255,255,255,0.1)}.ux-title{font-weight:700;font-size:14px;margin-bottom:10px}.ux-progress-bar{height:6px;background:rgba(255,255,255,0.1);border-radius:3px;overflow:hidden}.ux-progress-fill{height:100%;background:linear-gradient(90deg,#10b981,#34d399);transition:width 0.3s}.ux-progress-text{font-size:11px;color:#94a3b8;margin-top:6px}.ux-body{padding:16px}.ux-task-title{font-weight:600;font-size:15px;margin-bottom:6px}.ux-task-desc{font-size:13px;color:#94a3b8;line-height:1.4;margin-bottom:12px}.ux-timer{font-size:24px;font-weight:700;color:#60a5fa;font-family:monospace}.ux-nav-hint{font-size:11px;color:#f59e0b;margin-top:10px;padding:8px;background:rgba(245,158,11,0.1);border-radius:6px}.ux-footer{padding:12px 16px;display:flex;gap:8px;border-top:1px solid rgba(255,255,255,0.1)}.ux-btn{flex:1;padding:10px;border:none;border-radius:8px;font-weight:600;font-size:12px;cursor:pointer;transition:all 0.2s}.ux-btn-done{background:#10b981;color:#fff}.ux-btn-done:hover{background:#059669}.ux-btn-skip{background:rgba(96,165,250,0.2);color:#60a5fa}.ux-btn-skip:hover{background:rgba(96,165,250,0.3)}.ux-btn-abandon{background:transparent;color:#f87171;border:1px solid rgba(248,113,113,0.3)}.ux-btn-abandon:hover{background:rgba(239,68,68,0.1)}.ux-complete{text-align:center;padding:30px 20px}.ux-complete-icon{font-size:40px;margin-bottom:10px}.ux-complete h3{margin:0 0 6px;color:#10b981}.ux-complete p{margin:0;color:#94a3b8;font-size:13px}"}function z(){return X(s.endpoint+"/tests/"+s.testId,"GET",null).then(function(t){return r=t,(!r.tasks||r.tasks.length===0)&&(r.tasks=[{title:r.name,description:r.instructions||r.description}]),t}).catch(function(t){console.error("[UXTest] Could not fetch test:",t),r={tasks:[{title:"Complete the task",description:"Follow the instructions"}]}})}var Q={init:function(t){if(!t||!t.projectId||!t.testId)throw new Error("projectId and testId required");var e=M(t.testId);return e&&!x?(console.log("[UXTest] Resuming session from previous page..."),s={projectId:e.projectId,testId:e.testId,variant:e.variant,endpoint:e.endpoint},h=e.sessionId,b=e.startTime,n=e.currentTaskIndex,m=e.taskStartTime,x=!0,_(),f("page_navigated",{url:location.href}),k=setInterval(p,1e4),window.addEventListener("beforeunload",function(){p(),I()}),z().then(function(){y(),setInterval(N,1e3),console.log("[UXTest] Session resumed - Task",n+1)})):x?(y(),Promise.resolve()):(s={projectId:t.projectId,testId:t.testId,variant:t.variant||"A",endpoint:(t.endpoint||q).replace(/\/$/,"")},h=L(),b=d(),m=d(),n=0,x=!0,_(),f("test_started",{url:location.href,userAgent:navigator.userAgent}),I(),k=setInterval(p,1e4),window.addEventListener("beforeunload",function(){p(),I()}),z().then(function(){y(),setInterval(N,1e3),console.log("[UXTest] Started -",r.tasks.length,"tasks")}))},nextTask:function(){if(!(!x||!r)){var t=r.tasks||[];if(f("task_skipped",{taskIndex:n}),n++,m=d(),I(),n>=t.length){var e=d()-b;f("test_completed",{completedTasks:n},e),p(),clearInterval(k),S(!1)}else w()}},logEvent:function(t,e){x&&f(t,e)},success:function(t){if(!(!x||!r)){var e=r.tasks||[];if(f("task_completed",D({taskIndex:n},t)),n++,m=d(),I(),n>=e.length){var a=d()-b;f("test_completed",{completedTasks:n},a),p(),clearInterval(k),S(!1)}else w(),console.log("[UXTest] Task done! Next:",n+1)}},abandon:function(t){if(x){var e=d()-b;f("test_abandoned",{reason:t,lastTaskIndex:n},e),p(),clearInterval(k),U(),S(!0)}},version:i,getSessionId:function(){return h},getQueueLength:function(){return u.length}};c.UXTest=Q})(typeof window!="undefined"?window:void 0);})();
//# sourceMappingURL=uxtest.min.js.map
